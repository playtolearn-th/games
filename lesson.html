<!DOCTYPE html>
<html lang="th">

    <head>
        <meta charset="UTF-8" />
        <title>‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏û‡∏¢‡∏±‡∏ç‡∏ä‡∏ô‡∏∞‡πÑ‡∏ó‡∏¢ ‡∏Å‚Äì‡∏Æ</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link href="https://fonts.googleapis.com/css2?family=TH+Sarabun+New:wght@700&display=swap" rel="stylesheet" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/page-flip/dist/css/page-flip.min.css" />
        <style>
            html,
            body {
                margin: 0;
                padding: 0;
                background: #f0f0f0;
                font-family: 'TH Sarabun New', sans-serif;
                height: 100%;
                overflow: hidden
            }

            h1 {
                margin: .5rem;
                text-align: center;
                font-size: clamp(1.5rem, 3vw, 2.5rem)
            }

            #preloader {
                position: fixed;
                inset: 0;
                background: #fff;
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 9999;
                font-size: 2rem
            }

            #container {
                display: flex;
                justify-content: center;
                align-items: center;
                height: 100vh;
                box-sizing: border-box
            }

            #flipbook {
                width: 90vw;
                height: 80vh;
                max-width: 1000px;
                max-height: 700px;
                background: #e0e0e0
            }

            .page {
                width: 100%;
                height: 100%;
                background: #fff;
                border: 1px solid #ccc;
                display: flex;
                justify-content: center;
                align-items: center;
                padding: 0;
                margin: 0;
                position: relative;
                box-sizing: border-box;
                overflow: hidden
            }

            .page:not(.image-page) span {
                font-size: 15vw;
                display: flex;
                justify-content: center;
                align-items: center;
                height: 100%;
                width: 100%;
                text-align: center;
                line-height: 1
            }

            .image-page {
                position: relative
            }

            .image-page img {
                max-width: 90%;
                max-height: 90%;
                object-fit: contain;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%)
            }

            #audio-unlock {
                position: fixed;
                inset: 0;
                background: rgba(0, 0, 0, .55);
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                color: #fff;
                text-align: center;
                padding: 1rem
            }

            #audio-unlock button {
                font-size: 1.1rem;
                padding: .7rem 1.2rem;
                border: none;
                border-radius: .75rem;
                cursor: pointer
            }
        </style>
    </head>

    <body>
        <div id="preloader">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
        <h1>üìñ ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏û‡∏¢‡∏±‡∏ç‡∏ä‡∏ô‡∏∞‡πÑ‡∏ó‡∏¢ ‡∏Å‚Äì‡∏Æ</h1>

        <div id="audio-unlock" role="dialog" aria-live="polite">
            <div style="font-size:1.1rem;margin-bottom:.75rem">‡πÅ‡∏ï‡∏∞‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏á</div>
            <button id="unlock-btn">üéß ‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á</button>
            <div style="margin-top:.5rem;opacity:.85;font-size:.95rem">*
                ‡∏ö‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏û‡∏Å‡∏û‡∏≤‡∏ö‡∏≤‡∏á‡∏£‡∏∏‡πà‡∏ô‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á</div>
        </div>

        <div id="container">
            <div id="flipbook"></div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/page-flip/dist/js/page-flip.browser.min.js"></script>
        <script>
            const chars = [
                "‡∏Å", "‡∏Ç", "‡∏É", "‡∏Ñ", "‡∏Ö", "‡∏Ü", "‡∏á", "‡∏à", "‡∏â", "‡∏ä", "‡∏ã", "‡∏å", "‡∏ç", "‡∏é", "‡∏è", "‡∏ê", "‡∏ë", "‡∏í", "‡∏ì",
                "‡∏î", "‡∏ï", "‡∏ñ", "‡∏ó", "‡∏ò", "‡∏ô", "‡∏ö", "‡∏õ", "‡∏ú", "‡∏ù", "‡∏û", "‡∏ü", "‡∏†", "‡∏°", "‡∏¢", "‡∏£", "‡∏•", "‡∏ß", "‡∏®", "‡∏©", "‡∏™", "‡∏´", "‡∏¨", "‡∏≠", "‡∏Æ"
            ];

            const flipbook = document.getElementById("flipbook");

            // ---- ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢‡∏á (‡∏û‡∏≤‡∏ò‡πÉ‡∏´‡∏°‡πà: sounds/character/X.mp3) ----
            const audioCache = new Map();
            let audioUnlocked = false;

            function getAudioForChar(ch) {
                if (audioCache.has(ch)) return audioCache.get(ch);
                const path = `sounds/character/${encodeURIComponent(ch)}.mp3`;
                const a = new Audio(path);
                a.preload = "auto";
                a.addEventListener("error", () => console.warn("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á:", path));
                audioCache.set(ch, a);
                return a;
            }

            function playSound(ch) {
                if (!audioUnlocked || !chars.includes(ch)) return;
                const a = getAudioForChar(ch);
                try { a.pause(); a.currentTime = 0; a.play().catch(() => { }); } catch (_) { }
            }

            // ---- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤ ----
            function createPage(content, isImage = false, altText = '') {
                const page = document.createElement("div");
                page.className = "page";
                if (isImage) {
                    page.classList.add("image-page");
                    const img = document.createElement("img");
                    img.src = content;
                    img.alt = altText || content;
                    page.appendChild(img);
                } else {
                    const span = document.createElement("span");
                    span.textContent = content;
                    page.appendChild(span);
                    page.addEventListener("click", () => playSound(content)); // ‡πÅ‡∏ï‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏ã‡πâ‡∏≥
                }
                return page;
            }

            // ‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏Å
            flipbook.appendChild(createPage("images/icon/cover01.png", true, "‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏Å"));

            // ‡∏´‡∏ô‡πâ‡∏≤‡∏û‡∏¢‡∏±‡∏ç‡∏ä‡∏ô‡∏∞‡πÅ‡∏•‡∏∞‡∏£‡∏π‡∏õ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö
            chars.forEach(ch => {
                flipbook.appendChild(createPage(ch)); // ‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏±‡∏Å‡∏©‡∏£
                const imagePath = `images/character/${encodeURIComponent(ch)}.png`;
                flipbook.appendChild(createPage(imagePath, true, ch)); // ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏π‡∏õ
            });

            // ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏ö
            flipbook.appendChild(createPage("‡∏à‡∏ö‡∏ö‡∏£‡∏¥‡∏ö‡∏π‡∏£‡∏ì‡πå"));

            let pageFlip = null;

            window.addEventListener("DOMContentLoaded", () => {
                pageFlip = new St.PageFlip(flipbook, {
                    width: flipbook.clientWidth / 2,
                    height: flipbook.clientHeight,
                    size: "fixed",
                    showCover: true,
                    usePortrait: false,
                    flippingTime: 800,
                    mobileScrollSupport: false
                });

                pageFlip.loadFromHTML(document.querySelectorAll(".page"));

                pageFlip.on("flip", (e) => {
                    const pages = document.querySelectorAll(".page");
                    const current = pages[e.data]; // ‡πÉ‡∏ä‡πâ‡∏î‡∏±‡∏ä‡∏ô‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
                    if (current && !current.classList.contains("image-page")) {
                        const ch = current.textContent.trim();
                        playSound(ch);
                    }
                });

                // Preload ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤
                chars.forEach(getAudioForChar);

                document.getElementById("preloader").style.display = "none";
            });

            // ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
            const unlockLayer = document.getElementById("audio-unlock");
            document.getElementById("unlock-btn").addEventListener("click", () => {
                audioUnlocked = true;
                try {
                    const pages = document.querySelectorAll(".page");
                    const idx = pageFlip ? pageFlip.getCurrentPageIndex() : 0;
                    const cur = pages[idx];
                    if (cur && !cur.classList.contains("image-page")) {
                        const ch = cur.textContent.trim();
                        playSound(ch);
                    }
                } catch (_) { }
                unlockLayer.style.display = "none";
            });

            // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡πà‡∏≠/‡∏Ç‡∏¢‡∏≤‡∏¢
            window.addEventListener("resize", () => {
                if (!pageFlip) return;
                pageFlip.update({ width: flipbook.clientWidth / 2, height: flipbook.clientHeight });
            });
        </script>
    </body>

</html>