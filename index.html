<!-- firebase-init.js อยู่ก่อนหน้านี้แล้ว -->
<script>
(function(){
  const params = new URLSearchParams(location.search);
  const next = params.get('redirect') || new URL('index.html', location.href).href; // ถ้าไม่มี redirect ก็กลับ index เอง

  const auth = firebase.auth();
  auth.onAuthStateChanged(function(user){
    if (user) {
      // ล็อกอินอยู่แล้ว → กลับไปหน้าที่เรียกมา
      location.replace(next);
    } else {
      // ยังไม่ล็อกอิน → ส่งไป login พร้อม redirect=next
      const loginUrl = new URL('login.html', location.href).href;
      location.replace(loginUrl + (loginUrl.includes('?') ? '&' : '?') + 'redirect=' + encodeURIComponent(next));
    }
  });
})();
</script>
